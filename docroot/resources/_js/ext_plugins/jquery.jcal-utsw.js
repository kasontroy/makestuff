/*
 * jCal calendar multi-day and multi-month datepicker plugin for jQuery
 *	version 0.3.7
 * Author: Jim Palmer
 * Released under MIT license.
 */
(function(d){d.fn.jCal=function(e){d.jCal(this,e);return this};d.jCal=function(f,e){e=d.extend({day:new Date(),days:1,showMonths:1,monthSelect:false,dCheck:function(h){return"day"},callback:function(h,i){return true},drawBack:function(){return true},selectedBG:"rgb(0, 143, 214)",defaultBG:"rgb(255, 255, 255)",dayOffset:0,scrollSpeed:150,forceWeek:false,dow:["S","M","T","W","T","F","S"],ml:["January","February","March","April","May","June","July","August","September","October","November","December"],ms:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_target:f},e);e.day=new Date(e.day.getFullYear(),e.day.getMonth(),1);if(!d(e._target).data("days")){d(e._target).data("days",e.days)}d(f).stop().empty();for(var g=0;g<e.showMonths;g++){d(f).append('<div class="jCalMo"></div>')}e.cID="c"+d(".jCalMo").length;d(".jCalMo",f).each(function(h){c(d(this),d.extend({},e,{ind:h,day:new Date(new Date(e.day.getTime()).setMonth(new Date(e.day.getTime()).getMonth()+h))}));a(d(this),d.extend({},e,{ind:h,day:new Date(new Date(e.day.getTime()).setMonth(new Date(e.day.getTime()).getMonth()+h))}))});if(d(e._target).data("day")&&d(e._target).data("days")){b(f,d(e._target).data("day"),d(e._target).data("days"),e)}if(typeof e.drawBack=="function"){e.drawBack()}};function c(f,e){d(f).append('<div class="jCal">'+((e.ind==0)?'<div class="left" />':"")+'<div class="month"><span class="monthName">'+e.ml[e.day.getMonth()]+'</span> <span class="monthYear">'+e.day.getFullYear()+"</span></div>"+((e.ind==(e.showMonths-1))?'<div class="right" />':"")+"</div>");d(document).find(".calWrapper .previous").bind("click",d.extend({},e),function(h){if(d(".jCalMask",h.data._target).length>0){return false}d(h.data._target).stop();var g={w:0,h:0};d(".jCalMo",h.data._target).each(function(){g.w+=d(this).width()+parseInt(d(this).css("padding-left"))+parseInt(d(this).css("padding-right"));var i=d(this).height()+parseInt(d(this).css("padding-top"))+parseInt(d(this).css("padding-bottom"));g.h=((i>g.h)?i:g.h)});d(h.data._target).prepend('<div class="jCalMo"></div>');h.data.day=new Date(d("div[id*="+h.data.cID+"d_]:first",h.data._target).attr("id").replace(h.data.cID+"d_","").replace(/_/g,"/"));h.data.day.setDate(1);h.data.day.setMonth(h.data.day.getMonth()-1);c(d(".jCalMo:first",h.data._target),h.data);a(d(".jCalMo:first",h.data._target),h.data);if(h.data.showMonths>1){d(".right",h.data._target).clone(true).appendTo(d(".jCalMo:eq(1) .jCal",h.data._target));d(".left:last, .right:last",h.data._target).remove()}d(h.data._target).append('<div class="jCalSpace" style="width:'+g.w+"px; height:"+g.h+'px;"></div>');d(".jCalMo",h.data._target).wrapAll('<div class="jCalMask" style="clip:rect(0px '+g.w+"px "+g.h+"px 0px); width:"+(g.w+(g.w/h.data.showMonths))+"px; height:"+g.h+'px;"><div class="jCalMove"></div></div>');d(".jCalMove",h.data._target).css("margin-left",((g.w/h.data.showMonths)*-1)+"px").css("opacity",0.5).animate({marginLeft:"0px"},h.data.scrollSpeed,function(){d(this).children(".jCalMo:not(:last)").appendTo(d(h.data._target));d(".jCalSpace, .jCalMask",h.data._target).empty().remove();if(d(h.data._target).data("day")){b(h.data._target,d(h.data._target).data("day"),d(h.data._target).data("days"),h.data)}if(typeof e.drawBack=="function"){e.drawBack()}})});d(document).find(".calWrapper .next").bind("click",d.extend({},e),function(h){if(d(".jCalMask",h.data._target).length>0){return false}d(h.data._target).stop();var g={w:0,h:0};d(".jCalMo",h.data._target).each(function(){g.w+=d(this).width()+parseInt(d(this).css("padding-left"))+parseInt(d(this).css("padding-right"));var i=d(this).height()+parseInt(d(this).css("padding-top"))+parseInt(d(this).css("padding-bottom"));g.h=((i>g.h)?i:g.h)});d(h.data._target).append('<div class="jCalMo"></div>');h.data.day=new Date(d("div[id^="+h.data.cID+"d_]:last",h.data._target).attr("id").replace(h.data.cID+"d_","").replace(/_/g,"/"));h.data.day.setDate(1);h.data.day.setMonth(h.data.day.getMonth()+1);c(d(".jCalMo:last",h.data._target),h.data);a(d(".jCalMo:last",h.data._target),h.data);if(h.data.showMonths>1){d(".left",h.data._target).clone(true).prependTo(d(".jCalMo:eq(1) .jCal",h.data._target));d(".left:first, .right:first",h.data._target).remove()}d(h.data._target).append('<div class="jCalSpace" style="width:'+g.w+"px; height:"+g.h+'px;"></div>');d(".jCalMo",h.data._target).wrapAll('<div class="jCalMask" style="clip:rect(0px '+g.w+"px "+g.h+"px 0px); width:"+(g.w+(g.w/h.data.showMonths))+"px; height:"+g.h+'px;"><div class="jCalMove"></div></div>');d(".jCalMove",h.data._target).css("opacity",0.5).animate({marginLeft:((g.w/h.data.showMonths)*-1)+"px"},h.data.scrollSpeed,function(){d(this).children(".jCalMo:not(:first)").appendTo(d(h.data._target));d(".jCalSpace, .jCalMask",h.data._target).empty().remove();if(d(h.data._target).data("day")){b(h.data._target,d(h.data._target).data("day"),d(h.data._target).data("days"),h.data)}d(this).children(".jCalMo:not(:first)").removeClass("");if(typeof e.drawBack=="function"){e.drawBack()}})})}function b(i,l,n,e){var g=new Date(l.getTime());var m=new Date(l.getTime());for(var j=false,k=0,h=n;k<h;k++){var f=d(i).find("div[id*=d_"+(m.getMonth()+1)+"_"+m.getDate()+"_"+m.getFullYear()+"]");if(f.length>0){f.stop().addClass("selectedDay");j=true}m.setDate(m.getDate()+1)}if(j&&typeof e.callback=="function"){e.callback(l,n)}}function a(o,f){for(var j=0,g=f.dow.length;j<g;j++){d(o).append('<div class="dow">'+f.dow[j]+"</div>")}var h=new Date(new Date(f.day.getTime()).setDate(1));var k=new Date(new Date(h.getTime()).setDate(0));var e=new Date(new Date(new Date(h.getTime()).setMonth(h.getMonth()+1)).setDate(0));var l={fd:h.getDay(),lld:k.getDate(),ld:e.getDate()};var n=((l.fd<f.dayOffset)?(f.dayOffset-7):1);var m=((e.getDay()<f.dayOffset)?(7-e.getDay()):e.getDay());for(var p=n,i=(l.fd+l.ld+(7-m));p<i;p++){d(o).append(((p<=(l.fd-f.dayOffset))?'<div id="'+f.cID+"d"+p+'" class="pday"></div>':((p>((l.fd-f.dayOffset)+l.ld))?'<div id="'+f.cID+"d"+p+'" class="aday"></div>':'<div id="'+f.cID+"d_"+(h.getMonth()+1)+"_"+(p-(l.fd-f.dayOffset))+"_"+h.getFullYear()+'" class="'+(f.dCheck(new Date((new Date(h.getTime())).setDate(p-(l.fd-f.dayOffset))))||"invday")+'">'+(p-(l.fd-f.dayOffset))+"</div>")))}d(o).find("div[id^="+f.cID+"d]:first, div[id^="+f.cID+"d]:nth-child(7n+2)").before('<br style="clear:both;" />');d(o).find("div[id^="+f.cID+"d]:last").after('<br style="clear:both;" />');d(o).find("div[id^="+f.cID+"d_]:not(.invday)").bind("mouseover mouseout click",d.extend({},f),function(t){if(d(".jCalMask",t.data._target).length>0){return false}var u=new Date(d(this).attr("id").replace(/c[0-9]{1,}d_([0-9]{1,2})_([0-9]{1,2})_([0-9]{4})/,"$1/$2/$3"));if(t.data.forceWeek){u.setDate(u.getDate()+(t.data.dayOffset-u.getDay()))}var s=new Date(u.getTime());if(t.type=="click"){d("div[id*=d_]",t.data._target).stop().removeClass("selectedDay").removeClass("overDay")}for(var q=0,r=d(t.data._target).data("days");q<r;q++){var v=d(t.data._target).find("#"+t.data.cID+"d_"+(s.getMonth()+1)+"_"+s.getDate()+"_"+s.getFullYear());if(v.length==0||d(v).hasClass("invday")){break}if(t.type=="mouseover"){d(v).addClass("overDay")}else{if(t.type=="mouseout"){d(v).stop().removeClass("overDay")}else{if(t.type=="click"){d(v).stop().addClass("selectedDay")}}}s.setDate(s.getDate()+1)}if(t.type=="click"){t.data.day=u;if(t.data.callback(u,q,this)){d(t.data._target).data("day",t.data.day).data("days",q)}}})}})(jQuery);